<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stempel Mock-Up Vorschau</title>
  <style>
    @font-face {
      font-family: 'MarshStencil';
      src: url('https://cdn.jsdelivr.net/gh/Nukl34r20m813/MarshStencil@main/Marsh-Stencil.woff') format('woff');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'ComicSansMS';
      src: url('https://cdn.jsdelivr.net/gh/Nukl34r20m813/MarshStencil@main/comic_sans_ms-webfont.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'ArialNarrow';
      src: url('https://cdn.jsdelivr.net/gh/Nukl34r20m813/MarshStencil@main/arialnarrow-webfont.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    @font-face {
      font-family: 'ArialNarrow';
      src: url('https://cdn.jsdelivr.net/gh/Nukl34r20m813/MarshStencil@main/arialnarrow_bold-webfont.woff2') format('woff2');
      font-weight: bold;
      font-style: normal;
      font-display: swap;
    }

    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #fff;
      color: #333;
      padding: 20px;
      display: flex;
      justify-content: center;
      overflow-x: auto;
    }
  .container {
  width: 100%;
  max-width: 900px;
  min-width: 0;              /* <- Nie breiter als Viewport */
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.4);
  padding: 20px;
  box-sizing: border-box;    /* <- WICHTIG für saubere Breite */
}
    h2 { text-align: center; margin-bottom: 20px; }
    .form-group { display: flex; align-items: center; margin-bottom: 15px; flex-wrap: wrap; }
    .form-group label { flex: 0 0 100px; font-weight: bold; margin-bottom: 5px; }
    .form-group input[type="text"], .form-group select { flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #ccc; transition: border-color 0.2s; }

#outputBox {
  width: 100%;
  max-width: 700px;
  min-width: 0;
  border: 2px solid #333;
  border-radius: 2px;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  padding: 0px;
  background-size: cover;
  background-position: center;
  margin: 0 auto 10px;
  position: relative;
  aspect-ratio: 6 / 1; /* Standard, JS überschreibt */
}

    #textContent {
      white-space: nowrap;
      overflow: hidden;
      display: block;
      width: 100%;
      text-align: center;
    }

    .min-height-line {
      position: absolute;
      width: 60px;
      height: 2px;
      background: #e53935;
      z-index: 2;
      opacity: 0.9;
      border-radius: 2px;
      pointer-events: none;
    }
    .top-left {
      top: 17%; left: 0;
      transform: translateY(-50%);
    }
    .top-right {
      top: 17%; right: 0;
      transform: translateY(-50%);
    }
    .bottom-left {
      bottom: 17%; left: 0;
      transform: translateY(50%);
    }
    .bottom-right {
      bottom: 17%; right: 0;
      transform: translateY(50%);
    }

    .hint {
      text-align: left;
      font-size: 0.95rem;
      color: #444;
      margin-top: 18px;
      padding: 0;
    }
    .info-list {
      margin: 0;
      padding-left: 1.2em;
      text-align: left;
      color: #555;
      font-size: 0.97em;
      line-height: 1.6;
      list-style-position: outside;
    }
    @media (max-width: 750px) {
      body {
        display: block;
        padding: 0;
        overflow-x: hidden;
      }
      .container {
        min-width: 0;
        width: 100vw;
        max-width: 100vw;
        box-sizing: border-box;
        padding: 10px;
        border-radius: 0;
        box-shadow: none;
      }
      .form-group label {
        flex: 0 0 100%;
      }
      #outputBox {
        min-width: 0;
        max-width: 98vw;
    
      }
      .min-height-line { width: 25px; }
      .info-list, .hint {
        font-size: 0.97em;
        line-height: 1.5;
        padding-left: 0.7em;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Vorschau deines Stempels</h2>
  <div id="outputBox">
    <div class="min-height-line top-left"></div>
    <div class="min-height-line top-right"></div>
    <div class="min-height-line bottom-left"></div>
    <div class="min-height-line bottom-right"></div>
    <span id="textContent"></span>
  </div>
  <div id="sizeInfo" style="text-align: center; font-weight: bold; margin-bottom: 10px;"></div>

  <div class="form-group">
    <label for="inputText">Text:</label>
    <input type="text" id="inputText" placeholder="Gib deinen Text ein...">
  </div>
  <div class="form-group">
    <label for="stampLengthSelect">Version:</label>
    <select id="stampLengthSelect">
      <option value="6">10 cm Textlänge</option>
      <option value="11">20 cm Textlänge</option>
      <option value="17">30 cm Textlänge</option>
    </select>
    <a id="productLinkDE" href="https://www.dhinotec.com/product-page/inkrunner-set-personalisiert" target="_blank" style="margin-left:10px;padding:8px 12px;background:#007BFF;color:#fff;text-decoration:none;border-radius:4px;">Zum Produkt</a>
  </div>
  <div class="form-group">
    <label for="fontSelect">Schriftart:</label>
    <select id="fontSelect">
      <option value="Arial">Arial</option>
      <option value="ArialNarrow">Arial Narrow</option>
      <option value="ComicSansMS">Comic Sans MS</option>
      <option value="MarshStencil">Marsh Stencil</option>
    </select>
    <input type="color" id="textColor" value="#000000">
    <input type="checkbox" id="boldCheck">
    <label for="boldCheck">Fett</label>
  </div>
  <div class="form-group">
    <label for="backgroundSelect">Untergrund:</label>
    <select id="backgroundSelect">
      <option value="https://i.imgur.com/HIdmt4L.jpeg">Holz</option>
      <option value="https://i.imgur.com/f6RsubC.jpeg">Beton</option>
      <option value="https://i.imgur.com/dmRPFAs.png">Pappe</option>
      <option value="https://i.imgur.com/uSJq7uK.jpeg">Stoff</option>
    </select>
  </div>
  <!-- Hinweise ganz am Ende! -->
  <div class="hint">
    <ul class="info-list">
      <li>Diese Vorschau ist nur eine Annäherung.</li>
      <li>Die roten Linien zeigen die empfohlene Mindesthöhe für gut lesbaren Text.</li>
      <li>Führungslinien zwischen den Wörtern werden später ergänzt.</li>
      <li>Buchstaben mit Unterlängen wie <b>g</b> oder <b>j</b> (und auch Buchstaben wie <b>Ä</b> mit Überlängen) reduzieren die Schrifthöhe, weshalb wir Text in GROSSBUCHSTABEN empfehlen, sofern keine Umlaute verwendet werden.</li>
    </ul>
  </div>
</div>
<script>
function loadSelectedFont() {
  const font = document.getElementById('fontSelect').value;
  const bold = document.getElementById('boldCheck').checked ? 'bold' : 'normal';
  let family = 'Arial';
  if (font === 'MarshStencil') family = 'MarshStencil';
  else if (font === 'ComicSansMS') family = 'ComicSansMS';
  else if (font === 'ArialNarrow') family = 'ArialNarrow';
  return document.fonts.load(`${bold} 16px '${family}'`);
}

function updateAspectRatio(aspectRatio) {
  const box = document.getElementById('outputBox');
  if (CSS.supports('aspect-ratio: 1 / 1')) {
    box.style.aspectRatio = `${aspectRatio} / 1`;
    box.style.height = '';
  } else {
    box.style.aspectRatio = '';
    const width = box.clientWidth;
    box.style.height = (width / aspectRatio) + 'px';
  }
}

const DESKTOP_OFFSETS = { boxPadding: 10, widthOffset: 15, heightOffset: 7 };
const MOBILE_OFFSETS = { boxPadding: 10, widthOffset: 15, heightOffset: 7 };

function getOffsets() {
  return window.innerWidth <= 750 ? MOBILE_OFFSETS : DESKTOP_OFFSETS;
}


function adjustFontSize() {
  const outputBox = document.getElementById('outputBox');
  const textElem = document.getElementById('textContent');
  const inputTextField = document.getElementById('inputText');
  const aspectRatio = document.getElementById('stampLengthSelect').value;
  const font = document.getElementById('fontSelect').value;

  let fontStack;
  if (font === 'MarshStencil') {
    fontStack = "'MarshStencil', Arial, sans-serif";
  } else if (font === 'ComicSansMS') {
    fontStack = "'ComicSansMS', Arial, sans-serif";
  } else if (font === 'ArialNarrow') {
    fontStack = "'ArialNarrow', Arial, sans-serif";
  } else {
    fontStack = "Arial, sans-serif";
  }

  const bold = document.getElementById('boldCheck').checked ? 'bold' : 'normal';
  const textColor = document.getElementById('textColor').value;
  let text = inputTextField.value;

  // Flexible Fontgröße, aber Mindesthöhe durch Linien angezeigt
  let fontSize = 200;
  const ctx = document.createElement('canvas').getContext('2d');
  const { boxPadding, widthOffset, heightOffset } = getOffsets();
  const boxWidth = outputBox.clientWidth - boxPadding;
  const boxHeight = outputBox.clientHeight - boxPadding;

  // Nur runterskalieren, wenn Text zu groß
  while (fontSize > 10) {
    ctx.font = `${bold} ${fontSize}px ${fontStack}`;
    const metrics = ctx.measureText(text);
    const textWidth = metrics.width;
    const textHeight = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;
    if (textWidth - widthOffset <= boxWidth &&
        textHeight - heightOffset <= boxHeight) break;
    fontSize--;
  }

  textElem.style.fontFamily = fontStack;
    textElem.style.fontWeight = bold;
    textElem.style.fontSize = fontSize + 'px';
    textElem.style.color = textColor;
    textElem.textContent = text;

  if (font === 'MarshStencil' && window.innerWidth <= 750) {
    textElem.style.lineHeight = '0.85';
  } else {
    textElem.style.lineHeight = '';
  }

  // Setze oder berechne das Seitenverhältnis
  updateAspectRatio(aspectRatio);

  // Vorschauinfo
  document.getElementById('sizeInfo').innerHTML =
    `Vorschau entspricht ${getRealSize(aspectRatio)}<br><span style="font-size:0.95em;color:#3973b7;">Unterschreiten der roten Markierungen kann zu geringer Lesbarkeit führen.</span>`;
}

function getRealSize(aspectRatio) {
  if (aspectRatio == "6") return "14 x 100 mm";
  if (aspectRatio == "11") return "14 x 200 mm";
  if (aspectRatio == "17") return "14 x 300 mm";
  return "";
}

function updateBackground() {
  document.getElementById('outputBox').style.backgroundImage =
    `url('${document.getElementById('backgroundSelect').value}')`;
}

function updateStampVersion() {
  const aspectRatio = document.getElementById('stampLengthSelect').value;
  updateAspectRatio(aspectRatio);
  const link = document.getElementById('productLinkDE');
  if (aspectRatio == '6') link.href = 'https://www.dhinotec.com/product-page/inkrunner-set-personalisiert';
  else if (aspectRatio == '11') link.href = 'https://www.dhinotec.com/product-page/inkrunner-set-personalisiert-20-cm';
  else if (aspectRatio == '17') link.href = 'https://www.dhinotec.com/product-page/inkrunner-set-personalisiert-30-cm';
  adjustFontSize();
}

// Events
['inputText', 'textColor'].forEach(id =>
  document.getElementById(id).addEventListener('input', adjustFontSize));

document.getElementById('boldCheck').addEventListener('input', () => {
  loadSelectedFont().then(adjustFontSize);
});

document.getElementById('fontSelect').addEventListener('change', () => {
  loadSelectedFont().then(adjustFontSize);
});

['backgroundSelect', 'stampLengthSelect'].forEach(id =>
  document.getElementById(id).addEventListener('change',
    id === 'backgroundSelect' ? updateBackground : updateStampVersion)
);

// Initiale Darstellung erst nach Laden der Webfonts
document.fonts.ready.then(() => {
  adjustFontSize();
  updateBackground();
  updateStampVersion();
});

if (!CSS.supports('aspect-ratio: 1 / 1')) {
  window.addEventListener('resize', () => {
    const ratio = document.getElementById('stampLengthSelect').value;
    updateAspectRatio(ratio);
  });
}
</script>
</body>
</html>
